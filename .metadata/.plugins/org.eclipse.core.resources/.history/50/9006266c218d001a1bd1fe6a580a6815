<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:websocket="http://www.mulesoft.org/schema/mule/websocket" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/websocket http://www.mulesoft.org/schema/mule/websocket/current/mule-websocket.xsd">
	<websocket:config name="WebSockets_Config" doc:name="WebSockets Config" doc:id="85fac1d1-a205-44ba-9387-99db191c2031" >
		<websocket:connection >
			<websocket:server-settings listenerConfig="HTTPS_Listener_config" idleSocketTimeout="20"/>
		</websocket:connection>
	</websocket:config>
	<flow name="websocketsFlow" doc:id="3f2f890e-92c3-42e1-94d5-449fb8c82f6a" >
		<websocket:on-inbound-connection doc:name="On New Inbound Connection" doc:id="42b73788-2cbc-4237-99e7-b01e5bd2935e" config-ref="WebSockets_Config" path="/g/*"/>
		<set-variable value="#[attributes.socketId]" doc:name="socketId" doc:id="faed8313-c0ce-4c14-8992-33541b277c16" variableName="socketId"/>
		<set-variable value="#[%dw 2.0
import * from dw::core::Strings
output application/json
---
substringAfterLast(attributes.path, '/')]" doc:name="gameId" doc:id="5619da57-e63c-488e-ae5e-88bc8f7a9280" variableName="gameId"/>
		<logger level="INFO" doc:name="attributes" doc:id="5b73753b-9e7a-4f06-92e5-01cc8ec07a4d" message="#[%dw 2.0
output application/json
---
attributes]" />
		<logger level="INFO" doc:name="gameid" doc:id="632d3ef6-07d5-487b-98d7-745e0751ea6b" message="#[&quot;
GameId&quot;++(vars.gameId default '')]"/>
	</flow>
	<flow name="websocketsFlow1" doc:id="2c041a55-c869-477f-b90f-7aa5fb5f3736" >
		<websocket:inbound-listener doc:name="On New Inbound Message" doc:id="74798db5-803b-4b4f-bf4f-2ca0e0ddc038" config-ref="WebSockets_Config" path="/g/*"/>
		<set-variable value="#[%dw 2.0
import * from dw::core::Strings
output application/json
---
substringAfterLast(attributes.path, '/')]" doc:name="gameId" doc:id="5bea72ee-bc03-4318-91ff-a29f4a8caead" variableName="gameId" />
		<websocket:broadcast doc:name="Broadcast" doc:id="f083988b-9bd7-4495-b872-6cfe52f855db" config-ref="WebSockets_Config" path="#['/g/' ++ vars.gameId]"/>
		<logger level="INFO" doc:name="Logger" doc:id="5d0df531-aeb7-4461-abde-b793891d8808" />
	</flow>
	<flow name="Copy_of_websocketsFlow" doc:id="562e9441-64d6-4182-9d82-f9ec05f29471" >
		<websocket:on-inbound-connection doc:name="/*" doc:id="0e97d325-5e35-4c14-854a-ad0cdbe02be6" config-ref="WebSockets_Config" path="/*" />
		<logger level="INFO" doc:name="Logger" doc:id="4eebe4b8-9ac7-49f2-ac19-5d1aaa042bef" />
	</flow>
</mule>
